<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TOTTORI ARCHIVE</title>
    <link href="https://cdn.jsdelivr.net/gh/sun-typeface/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        :root {
            --paper: #D1D3D3; 
            --ink: #1a1a1a;
            --border: #A0A2A2;
            --font-serif: "Times New Roman", "serif";
            --card-inner-bg: rgba(255, 255, 255, 0.15);
            --accent: #4A565C;
        }

        body {
            margin: 0;
            font-family: 'Pretendard', sans-serif;
            background-color: var(--paper);
            background-image: url("https://www.transparenttextures.com/patterns/asfalt-dark.png");
            color: var(--ink);
            line-height: 1.6;
            padding-bottom: 140px; 
            word-break: keep-all;
            -webkit-tap-highlight-color: transparent;
        }

        header { padding: 40px 20px 20px; max-width: 600px; margin: 0 auto; text-align: center; }
        header h1 { font-size: 11px; letter-spacing: 0.3em; margin-bottom: 10px; opacity: 0.6; }
        .main-title { font-size: 42px; font-family: var(--font-serif); border-bottom: 2px solid var(--ink); display: inline-block; line-height: 1.1; }
        .sub-title { font-size: 24px; font-weight: 300; display: block; margin-top: 5px; opacity: 0.8; }

        nav { position: fixed; bottom: 20px; left: 0; right: 0; width: 100%; display: flex; justify-content: center; z-index: 1000; }
        .nav-inner { 
            display: flex; gap: 4px; background: rgba(20, 20, 20, 0.9); 
            padding: 8px 12px; border-radius: 40px; backdrop-filter: blur(15px); 
            border: 1px solid rgba(255,255,255,0.1); width: 90%; overflow-x: auto; 
            scrollbar-width: none; -ms-overflow-style: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .nav-inner::-webkit-scrollbar { display: none; }
        .nav-inner a { 
            text-decoration: none; font-size: 10px; color: #888; padding: 10px 14px; 
            border-radius: 30px; font-weight: 800; transition: 0.2s; white-space: nowrap; flex-shrink: 0;
        }
        .nav-inner a.active { background: #fff; color: #000; }

        .container { max-width: 600px; margin: 0 auto; padding: 0 20px; }
        .content-section { display: none; animation: fadeIn 0.4s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-title { font-size: 11px; letter-spacing: 0.15em; margin: 35px 0 15px; font-weight: 800; color: #333; opacity: 0.8; }
        .card { border: 1px solid var(--border); padding: 2px; margin-bottom: 15px; background: transparent; }
        .card-inner { border: 1px solid var(--border); padding: 16px; background: var(--card-inner-bg); position: relative; }

        .check-item { display: flex; align-items: flex-start; gap: 10px; cursor: pointer; margin-bottom: 10px; min-height: 32px; position: relative; }
        .check-item input[type="checkbox"] {
            appearance: none; -webkit-appearance: none; 
            width: 20px; height: 20px; border: 1px solid var(--ink);
            background: transparent; cursor: pointer; flex-shrink: 0; margin: 0; position: relative;
        }
        .check-item input[type="checkbox"]:checked { background: var(--ink); }
        .check-item input[type="checkbox"]:checked::after { 
            content: '‚úì'; color: white; position: absolute; font-size: 14px; left: 4px; top: -2px; 
        }
        .check-text { font-size: 13px; line-height: 20px; font-weight: 500; }

        input, select, textarea { 
            width: 100%; padding: 12px; border: 1px solid var(--border); 
            background: rgba(255, 255, 255, 0.5); margin-bottom: 8px; 
            font-family: inherit; font-size: 14px; box-sizing: border-box; border-radius: 0;
        }
        .btn-black { 
            background: var(--ink); color: #fff; border: none; padding: 15px; 
            width: 100%; cursor: pointer; font-size: 11px; font-weight: 700; letter-spacing: 0.1em;
        }

        .btn-del { color: #888; font-size: 11px; cursor: pointer; float: right; padding: 5px; }
        .img-scroll { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; -webkit-overflow-scrolling: touch; }
        .img-scroll img { width: 85px; height: 85px; object-fit: cover; border: 1px solid var(--border); flex-shrink: 0; }

        .monitor { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .monitor-item { border: 1px solid var(--border); background: var(--card-inner-bg); padding: 12px 4px; text-align: center; font-size: 9px; }
        .monitor-item b { display: block; font-size: 13px; margin-top: 4px; color: #000; }

        details summary { cursor: pointer; font-size: 12px; font-weight: bold; padding: 12px; background: rgba(0,0,0,0.05); margin-bottom: 8px; border: 1px solid var(--border); }
        .prep-box { background: var(--ink); color: #fff; padding: 20px; margin-top: 10px; }
    </style>
</head>
<body>

<header onclick="showTab('home')">
    <h1>TOTTORI ARCHIVE</h1>
    <span class="main-title">Á∂¥„Çã</span>
    <span class="sub-title">Âá∫Êù•‰∫ã</span>
</header>

<nav>
    <div class="nav-inner">
        <a href="javascript:void(0)" onclick="showTab('home')" id="btn-home" class="active">HOME</a>
        <a href="javascript:void(0)" onclick="showTab('prep')" id="btn-prep">PREP</a>
        <a href="javascript:void(0)" onclick="showTab('plan')" id="btn-plan">PLAN</a>
        <a href="javascript:void(0)" onclick="showTab('drive')" id="btn-drive">DRIVE</a>
        <a href="javascript:void(0)" onclick="showTab('pay')" id="btn-pay">PAY</a>
        <a href="javascript:void(0)" onclick="showTab('diary')" id="btn-diary">DIARY</a>
        <a href="javascript:void(0)" onclick="showTab('link')" id="btn-link">LINK</a>
    </div>
</nav>

<div class="container">
    <section id="tab-home" class="content-section active">
        <div class="card"><div class="card-inner">
            <p style="font-size:15px; line-height: 1.8; font-family: var(--font-serif); text-align: center; margin: 10px 0;">"ÏÇ¨Íµ¨ÏóêÏÑúÏùò Î∞îÎûåÍ≥º,<br>Î∞îÎã§Ïùò ÏÜåÎ¶¨Î•º Ïù¥Í≥≥Ïóê ÏóÆÏäµÎãàÎã§."</p>
        </div></div>
        <div class="section-title">Settings</div>
        <div class="card"><div class="card-inner">
            <p style="font-size:11px; margin-bottom:10px; opacity:0.7;">Ïó¨Ìñâ Ïù∏ÏõêÏùò Ïù¥Î¶ÑÏùÑ ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.</p>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                <input type="text" id="nameA" placeholder="Ïù∏Ïõê A Ïù¥Î¶Ñ (Ïòà: Í∏∏Îèô)">
                <input type="text" id="nameB" placeholder="Ïù∏Ïõê B Ïù¥Î¶Ñ (Ïòà: Ï≤†Ïàò)">
            </div>
            <button onclick="updateNames()" class="btn-black">SET NAMES</button>
        </div></div>
    </section>

    <section id="tab-prep" class="content-section">
        <div class="section-title">Checklist</div>
        <div class="card"><div class="card-inner" id="fixedPrep" style="display:grid; grid-template-columns:1fr 1fr; gap:2px;"></div></div>
        <input type="text" id="prepIn" placeholder="Ï∂îÍ∞Ä Ìï≠Î™©">
        <button onclick="addItem('prep')" class="btn-black">ADD ITEM</button>
        <div id="customPrepList" style="margin-top:10px;"></div>
    </section>

    <section id="tab-plan" class="content-section">
        <div class="section-title">Recommendations</div>
        <details><summary>Ï∂îÏ≤ú Ïû•ÏÜå ÌîÑÎ¶¨ÏÖã Î≥¥Í∏∞</summary><div id="presetList" class="card" style="background: white;"></div></details>
        <div class="section-title">Google Maps</div>
        <div class="card"><div class="card-inner">
            <input type="text" id="mapSearch" placeholder="Ï∞æÍ≥† Ïã∂ÏùÄ Ïû•ÏÜå">
            <div style="display:flex; gap:8px;">
                <button onclick="searchMap()" style="flex:1; padding:12px; border:1px solid var(--ink); background:none; font-size:10px; font-weight:bold;">SEARCH</button>
                <button onclick="linkLocation()" style="flex:1; padding:12px; border:1px solid var(--ink); background:var(--ink); color:#fff; font-size:10px; font-weight:bold;">LINK TO PLAN</button>
            </div>
        </div></div>
        <div id="planList"></div>
        <div class="section-title">Add Schedule</div>
        <div class="card"><div class="card-inner">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                <select id="planDay"><option value="1">DAY 1</option><option value="2">DAY 2</option><option value="3">DAY 3</option></select>
                <input type="time" id="planTime">
            </div>
            <input type="text" id="planTitle" placeholder="Ïû•ÏÜåÎ™Ö">
            <textarea id="planMemo" placeholder="Î©îÎ™®" rows="2"></textarea>
            <button onclick="addItem('plan')" class="btn-black">SAVE PLAN</button>
        </div></div>
    </section>

    <section id="tab-drive" class="content-section">
        <div class="section-title">6 Driving Principles</div>
        <div class="card"><div class="card-inner" id="principlesUI"></div></div>
        <div class="section-title">Required Items</div>
        <div class="prep-box" id="driveChecklistUI"></div>
    </section>

    <section id="tab-pay" class="content-section">
        <div class="monitor">
            <div class="monitor-item">Í≥µÍ∏à ÏûîÏï°<b id="b-p">¬•0</b></div>
            <div class="monitor-item"><span class="label-a">A</span> ÏûîÏï°<b id="b-a">¬•0</b></div>
            <div class="monitor-item"><span class="label-b">B</span> ÏûîÏï°<b id="b-b">¬•0</b></div>
        </div>
        <div id="payList"></div>
        <div class="card"><div class="card-inner">
            <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:8px; margin-bottom:8px;">
                <input type="number" id="bud-p" placeholder="Í≥µÍ∏à">
                <input type="number" id="bud-a" class="ph-a" placeholder="A ÏòàÏÇ∞">
                <input type="number" id="bud-b" class="ph-b" placeholder="B ÏòàÏÇ∞">
            </div>
            <button onclick="updateBud()" class="btn-black" style="background:#666; padding:10px; margin-bottom:10px;">SET BUDGET</button>
            <select id="payTarget">
                <option value="p">Í≥µÍ∏à</option>
                <option value="a" class="opt-a">A ÏÇ¨ÎπÑ</option>
                <option value="b" class="opt-b">B ÏÇ¨ÎπÑ</option>
            </select>
            <input type="text" id="payName" placeholder="ÎÇ¥Ïó≠">
            <input type="number" id="payAmt" placeholder="Í∏àÏï°(¬•)">
            <input type="file" id="payFile" multiple style="font-size: 11px;">
            <button onclick="addItem('pay')" class="btn-black">SAVE PAY</button>
        </div></div>
    </section>

    <section id="tab-diary" class="content-section">
        <div class="section-title">Journal</div>
        <div id="diaryList"></div>
        <div class="card"><div class="card-inner">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                <select id="diaryDay"><option value="1">DAY 1</option><option value="2">DAY 2</option><option value="3">DAY 3</option></select>
                <select id="diaryWeather"><option value="‚òÄÔ∏è">ÎßëÏùå</option><option value="‚òÅÔ∏è">ÌùêÎ¶º</option><option value="‚òî">ÎπÑ</option></select>
            </div>
            <input type="date" id="diaryDate">
            <select id="diaryUser">
                <option value="">ÏûëÏÑ±Ïûê ÏÑ†ÌÉù</option>
                <option value="a" class="opt-a">A</option>
                <option value="b" class="opt-b">B</option>
            </select>
            <textarea id="diaryText" placeholder="Ïò§ÎäòÏùò Ï∂îÏñµ..." rows="4"></textarea>
            <input type="file" id="diaryFile" multiple style="font-size: 11px;">
            <button onclick="addItem('diary')" class="btn-black">SAVE DIARY</button>
        </div></div>
    </section>

    <section id="tab-link" class="content-section">
        <div class="section-title">Essential Links</div>
        <div id="fixedLinks"></div>
        <div class="section-title">My Links</div>
        <div id="customLinks"></div>
        <div class="card"><div class="card-inner">
            <input type="text" id="linkName" placeholder="ÏÇ¨Ïù¥Ìä∏Î™Ö">
            <input type="text" id="linkUrl" placeholder="URL">
            <button onclick="addItem('link')" class="btn-black">ADD LINK</button>
        </div></div>
    </section>
</div>

<script>
    const PRESET_PREP = ["Ïó¨Í∂å/Î©¥ÌóàÏ¶ù", "ÌïúÍµ≠Î©¥ÌóàÏ¶ù", "ÎπÑÏßìÏû¨Ìå¨QR", "ÏóîÌôî ÌòÑÍ∏à", "110V ÎèºÏßÄÏΩî", "Î≥¥Ï°∞Î∞∞ÌÑ∞Î¶¨", "Ïú†Ïã¨/Ïù¥Ïã¨", "ÎπÑÏÉÅÏïΩ", "ÎèôÏ†ÑÏßÄÍ∞ë", "Î¨ºÌã∞Ïäà", "ÏÑ∏Î©¥ÎèÑÍµ¨", "ÎèºÏßÄÏΩî Ïñ¥ÎåëÌÑ∞"];
    const PRESET_PLACES = [{n: "ÎèóÌÜ†Î¶¨ ÏÇ¨Íµ¨", m: "ÏùºÎ≥∏ ÏµúÎåÄ Í∑úÎ™® Ìï¥Ïïà ÏÇ¨Íµ¨."}, {n: "Î™®Îûò ÎØ∏Ïà†Í¥Ä", m: "ÏÑ∏Í≥Ñ Ïú†Ïùº Î™®Îûò Î∞ïÎ¨ºÍ¥Ä."}, {n: "ÌïòÏø†ÌÜ† Ïã†ÏÇ¨", m: "Ïù∏Ïó∞ Îß∫Îäî ÌÜ†ÎÅº Ïã†ÏÇ¨."}, {n: "Ïø†ÎùºÏöîÏãú ÏãúÎùºÏπ¥Î≤† ÎèÑÏ°∞Íµ∞", m: "ÏóêÎèÑ ÏãúÎåÄ ÌïòÏñÄ Ï∞ΩÍ≥† Í±∞Î¶¨."}, {n: "ÏΩîÎÇú Î∞ïÎ¨ºÍ¥Ä", m: "ÏΩîÎÇú ÏûëÍ∞Ä Î∞ïÎ¨ºÍ¥Ä."}, {n: "ÎØ∏Ï¶àÌÇ§ ÏãúÍ≤åÎ£® Î°úÎìú", m: "ÏöîÍ¥¥ ÎèôÏÉÅ ÏÉÅÏ†êÍ∞Ä."}, {n: "Îã§Ïù¥ÏÑºÏÇ∞", m: "ÏÇ∞Ïù∏Ïùò ÌõÑÏßÄÏÇ∞."}];
    const PRESET_LINKS = [{h:"Visit Japan Web", u:"https://vjr.digital.go.jp/", d:"ÏûÖÍµ≠ Ïã¨ÏÇ¨ ÏÇ¨Ï†Ñ Îì±Î°ù"}, {h:"ÎèóÌÜ†Î¶¨ Í¥ÄÍ¥ë", u:"https://www.tottori-tour.jp/ko/", d:"Í≥µÏãù Í∞ÄÏù¥Îìú"}, {h:"ÏïºÌõÑ ÎÇ†Ïî®", u:"https://weather.yahoo.co.jp/weather/jp/31/6910.html", d:"Ïã§ÏãúÍ∞Ñ ÏòàÎ≥¥"}];
    const DRIVE_P = [{e:"üõë",b:"Ê≠¢„Åæ„Çå (ÌÜ†ÎßàÎ†à)",s:"Ï†ïÏßÄÏÑ†ÏóêÏÑú 3Ï¥à Ï†ïÏßÄ."}, {e:"‚¨ÖÔ∏è",b:"Ï¢åÏ∏° ÌÜµÌñâ",s:"ÏôºÏ™Ω ÏûëÍ≤å, Ïò§Î•∏Ï™Ω ÌÅ¨Í≤å."}, {e:"üõ§Ô∏è",b:"Ï≤†Í∏∏ Í±¥ÎÑêÎ™©",s:"Î¨¥Ï°∞Í±¥ ÏùºÏãúÏ†ïÏßÄ."}, {e:"üö¶",b:"Ïã†Ìò∏ Ï§ÄÏàò",s:"Ï†ÅÏã†Ìò∏ Ï¢åÌöåÏ†Ñ Í∏àÏßÄ."}, {e:"üö∂",b:"Î≥¥ÌñâÏûê Ïö∞ÏÑ†",s:"Ìö°Îã®Î≥¥ÎèÑ Ï†ïÏßÄ."}, {e:"‚ö†Ô∏è",b:"Ï§ëÏïôÏÑ† Ï§ÄÏàò",s:"ÎÖ∏ÎûÄ Ïã§ÏÑ† Ï∂îÏõî Í∏àÏßÄ."}];

    let db = { 
        customPrep: JSON.parse(localStorage.getItem('tot_cp')) || [], 
        plan: JSON.parse(localStorage.getItem('tot_pl')) || [], 
        pay: JSON.parse(localStorage.getItem('tot_py')) || [], 
        diary: JSON.parse(localStorage.getItem('tot_di')) || [], 
        links: JSON.parse(localStorage.getItem('tot_li')) || [], 
        buds: JSON.parse(localStorage.getItem('tot_bd')) || {p:0, a:0, b:0},
        names: JSON.parse(localStorage.getItem('tot_nm')) || {a: "Ïù∏ÏõêA", b: "Ïù∏ÏõêB"} 
    };

    function showTab(id) { 
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active')); 
        document.querySelectorAll('.nav-inner a').forEach(a => a.classList.remove('active')); 
        document.getElementById('tab-'+id).classList.add('active'); 
        document.getElementById('btn-'+id).classList.add('active'); 
        document.querySelectorAll('input:not([type="checkbox"]):not([type="number"]), textarea').forEach(el => {
            if(!['nameA', 'nameB'].includes(el.id)) el.value = '';
        });
        window.scrollTo(0,0); 
    }

    function updateNames() {
        const a = document.getElementById('nameA').value;
        const b = document.getElementById('nameB').value;
        if(a) db.names.a = a;
        if(b) db.names.b = b;
        save();
        alert("Ïù¥Î¶ÑÏù¥ ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§.");
    }

    function updateBud() { db.buds.p=Number(document.getElementById('bud-p').value); db.buds.a=Number(document.getElementById('bud-a').value); db.buds.b=Number(document.getElementById('bud-b').value); save(); alert("ÏòàÏÇ∞ Ï†ÄÏû•Îê®."); }
    async function getBase64(input) { if (!input.files || input.files.length === 0) return []; return Promise.all(Array.from(input.files).map(f => new Promise(res => { const r = new FileReader(); r.onload = e => res(e.target.result); r.readAsDataURL(f); }))); }

    async function addItem(type) { 
        if(type==='prep') { const v=document.getElementById('prepIn').value; if(v) db.customPrep.push(v); } 
        else if(type==='plan') { 
            const title = document.getElementById('planTitle').value; if(!title) return;
            db.plan.push({id:Date.now(), day:document.getElementById('planDay').value, time:document.getElementById('planTime').value, title:title, memo:document.getElementById('planMemo').value}); 
        } 
        else if(type==='pay') { 
            const imgs=await getBase64(document.getElementById('payFile')); 
            db.pay.unshift({id:Date.now(), target:document.getElementById('payTarget').value, name:document.getElementById('payName').value, amt:Number(document.getElementById('payAmt').value), imgs}); 
        } 
        else if(type==='diary') { 
            const u = document.getElementById('diaryUser').value; if(!u) { alert("ÏûëÏÑ±ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî."); return; }
            const imgs=await getBase64(document.getElementById('diaryFile')); 
            db.diary.unshift({id:Date.now(), day:document.getElementById('diaryDay').value, weather:document.getElementById('diaryWeather').value, date:document.getElementById('diaryDate').value, user:db.names[u], text:document.getElementById('diaryText').value, imgs, comments:[]}); 
        } 
        else if(type==='link') { 
            const n=document.getElementById('linkName').value; const u=document.getElementById('linkUrl').value; 
            if(n&&u) db.links.push({id:Date.now(), h:n, u:u.startsWith('http')?u:'https://'+u, d:"User Link"}); 
        } 
        save();
        document.querySelectorAll(`#tab-${type} input:not([type="checkbox"]), #tab-${type} textarea`).forEach(el => el.value = '');
    }

    function addComment(id) { 
        const input = document.getElementById(`cmt-in-${id}`); 
        if(input.value) { 
            const idx = db.diary.findIndex(d => d.id === id); 
            if(!db.diary[idx].comments) db.diary[idx].comments = []; 
            db.diary[idx].comments.push(input.value); save(); input.value = ''; 
        } 
    }

    function delItem(type, id) { if(confirm("ÏÇ≠Ï†ú?")) { if(type==='prep') db.customPrep.splice(id,1); else db[type]=db[type].filter(x=>x.id!==id); save(); } }
    function save() { 
        localStorage.setItem('tot_cp', JSON.stringify(db.customPrep)); localStorage.setItem('tot_pl', JSON.stringify(db.plan)); 
        localStorage.setItem('tot_py', JSON.stringify(db.pay)); localStorage.setItem('tot_di', JSON.stringify(db.diary)); 
        localStorage.setItem('tot_li', JSON.stringify(db.links)); localStorage.setItem('tot_bd', JSON.stringify(db.buds));
        localStorage.setItem('tot_nm', JSON.stringify(db.names)); render(); 
    }

    function render() {
        // Ïù¥Î¶Ñ UI Ïó∞Îèô
        document.querySelectorAll('.label-a').forEach(el => el.innerText = db.names.a);
        document.querySelectorAll('.label-b').forEach(el => el.innerText = db.names.b);
        document.querySelectorAll('.opt-a').forEach(el => el.innerText = db.names.a);
        document.querySelectorAll('.opt-b').forEach(el => el.innerText = db.names.b);
        document.querySelector('.ph-a').placeholder = `${db.names.a} ÏòàÏÇ∞`;
        document.querySelector('.ph-b').placeholder = `${db.names.b} ÏòàÏÇ∞`;
        document.getElementById('nameA').value = db.names.a;
        document.getElementById('nameB').value = db.names.b;

        // ÎÇòÎ®∏ÏßÄ Î†åÎçîÎßÅ
        document.getElementById('fixedPrep').innerHTML = PRESET_PREP.map(x=>`<label class="check-item"><input type="checkbox"><div class="check-text">${x}</div></label>`).join('');
        document.getElementById('customPrepList').innerHTML = db.customPrep.map((x,i)=>`<div style="font-size:13px; padding:8px 0; border-bottom:1px solid #ccc; display:flex; justify-content:space-between;"><span>‚Ä¢ ${x}</span> <button onclick="delItem('prep',${i})" class="btn-del">√ó</button></div>`).join('');
        
        db.plan.sort((a,b)=>a.day-b.day || a.time.localeCompare(b.time));
        document.getElementById('planList').innerHTML = db.plan.map(p=>`<div class="card"><div class="card-inner"><small>DAY ${p.day} | ${p.time}</small><br><b>${p.title}</b><p style="font-size:12px; color:#555;">${p.memo}</p><button onclick="delItem('plan',${p.id})" class="btn-del">Delete</button></div></div>`).join('');
        
        let spent = {p:0, a:0, b:0}; db.pay.forEach(e => spent[e.target] += e.amt);
        document.getElementById('b-p').innerText = `¬•${(db.buds.p - spent.p).toLocaleString()}`; 
        document.getElementById('b-a').innerText = `¬•${(db.buds.a - spent.a).toLocaleString()}`; 
        document.getElementById('b-b').innerText = `¬•${(db.buds.b - spent.b).toLocaleString()}`;
        
        document.getElementById('payList').innerHTML = db.pay.map(e=>`<div class="card"><div class="card-inner"><b>[${e.target === 'p' ? 'Í≥µÍ∏à' : db.names[e.target]}] ${e.name}</b><br><span>¬•${e.amt.toLocaleString()}</span><div class="img-scroll">${e.imgs.map(m=>`<img src="${m}">`).join('')}</div><button onclick="delItem('pay',${e.id})" class="btn-del">Delete</button></div></div>`).join('');
        
        document.getElementById('diaryList').innerHTML = db.diary.map(d=>`<div class="card"><div class="card-inner"><small>DAY ${d.day} | ${d.user}</small><p style="margin:10px 0; font-size:13px;">${d.text}</p><div class="img-scroll">${d.imgs.map(m=>`<img src="${m}">`).join('')}</div><div style="border-top:1px solid #ddd; margin-top:10px; padding-top:10px;">${(d.comments||[]).map(c=>`<div style="font-size:11px;">üí¨ ${c}</div>`).join('')}<div style="display:flex; gap:5px; margin-top:5px;"><input type="text" id="cmt-in-${d.id}" placeholder="ÎåìÍ∏Ä" style="margin:0; padding:5px;"><button onclick="addComment(${d.id})" style="padding:5px 10px;">OK</button></div></div><button onclick="delItem('diary',${d.id})" class="btn-del">Remove</button></div></div>`).join('');
        
        document.getElementById('fixedLinks').innerHTML = PRESET_LINKS.map(l=>`<a href="${l.u}" target="_blank" style="text-decoration:none; color:inherit;"><div class="card"><div class="card-inner"><b>${l.h}</b><br><small>${l.d}</small></div></div></a>`).join('');
        document.getElementById('customLinks').innerHTML = db.links.map(l=>`<div class="card"><div class="card-inner"><a href="${l.u}" target="_blank" style="text-decoration:none; color:inherit;"><b>${l.h}</b></a><button onclick="delItem('link',${l.id})" class="btn-del">√ó</button></div></div>`).join('');

        // DRIVE UI Í≥†Ï†ï Î†åÎçîÎßÅ
        document.getElementById('principlesUI').innerHTML = DRIVE_P.map(p=>`<div style="display:flex; gap:10px; margin-bottom:10px;"><span>${p.e}</span><div><b>${p.b}</b><br><small>${p.s}</small></div></div>`).join('');
        document.getElementById('driveChecklistUI').innerHTML = ["Íµ≠Ï†úÎ©¥ÌóàÏ¶ù", "ÌïúÍµ≠Î©¥ÌóàÏ¶ù", "Ïó¨Í∂å", "ÏòàÏïΩÏÑú", "ETCÏπ¥Îìú"].map(c=>`<label class="check-item"><input type="checkbox"><div class="check-text">${c}</div></label>`).join('');
        document.getElementById('presetList').innerHTML = PRESET_PLACES.map(p => `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee;"><span><b>${p.n}</b><br><small>${p.m}</small></span><button onclick="setPresetToInput('${p.n}', '${p.m}')">ADD</button></div>`).join('');
    }
    
    function searchMap() { const q = document.getElementById('mapSearch').value; if(q) window.open(`https://www.google.com/maps/search/${encodeURIComponent(q)}`, '_blank'); }
    function linkLocation() { const q = document.getElementById('mapSearch').value; if(q) { document.getElementById('planTitle').value = q; document.getElementById('planMemo').value = `Map: ${q}`; alert("Ïó∞ÎèôÎê®."); } }
    function setPresetToInput(n, m) { document.getElementById('planTitle').value = n; document.getElementById('planMemo').value = m; }

    window.onload = render;
</script>
</body>
</html>